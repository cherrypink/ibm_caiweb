<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ibm.gbs.gbs_cai_web.mapper.ClassMapper">
    <cache />
    <select id="getClassesByCondition" resultType="hashmap" parameterType="hashmap">
        SELECT *	   
        FROM CLASS
        WHERE booth=#{booth} and start=#{time} 
    </select>
    
    <select id="getDetailByCondition" resultType="hashmap" parameterType="int">
        SELECT *	   
        FROM CLASS
        WHERE idx=#{idx} 
    </select>
    
    
    <!--  Admin Page 관련 -->
    
    <select id="getClassList" resultType="com.ibm.gbs.gbs_cai_web.vo.ClassVO">
        SELECT *	   
        FROM CLASS
    </select>
    
    <select id="getClassID" resultType="String">
        SELECT LPAD((SELECT IFNULL(MAX(idx)+1, 1) FROM CLASS), 4, '0') 
        FROM DUAL;
    </select>
    
    <select id="getClassDetail" resultType="com.ibm.gbs.gbs_cai_web.vo.ClassVO">
        SELECT *	   
        FROM CLASS
        WHERE idx=#{idx}
    </select>
    
    <insert id="addClass" parameterType="com.ibm.gbs.gbs_cai_web.vo.ClassVO">
        INSERT INTO CLASS (
        	class_id
			,title
			,teacher
			,booth
			,start
			,end
			,date
			,capacity
			,detail
			,image
			,atta1
			,atta2
			,atta3
			,uploadPath)
        VALUES (
        	 #{class_id}
        	,#{title}
        	,#{teacher}
        	,#{booth}
        	,#{start}
        	,#{end}
        	,#{date}
        	,#{capacity}
        	,#{detail}
        	,#{image}
        	,#{atta1}
        	,#{atta2}
        	,#{atta3}
        	,#{uploadPath}     	
        )	
    </insert>
    
    <update id="modifyClass" parameterType="com.ibm.gbs.gbs_cai_web.vo.ClassVO">
        UPDATE CLASS SET
			title = #{title}
			,teacher = #{teacher}
			,booth = #{booth}
			,start = #{start}
			,end = #{end}
			,date = #{date}
			,capacity = #{capacity}
			,detail = #{detail}
			,image = #{image}
			,atta1 = #{atta1}
			,atta2 = #{atta2}
			,atta3 = #{atta3}
		WHERE
			idx = #{idx}
    </update>
    
    <delete id="deleteClass" parameterType="int">
        DELETE    
        FROM CLASS
        WHERE idx=#{idx}
    </delete>
    
    <!-- /* ClassController와 연동되는 Sql - 정연우(0224)*/ -->
    <select id="getMyLec" resultType="hashmap" parameterType="String">
        SELECT *	   
        FROM enrollment
        WHERE user_id=#{user_id} 
    </select>
    
    <select id="getThisLec" resultType="hashmap" parameterType="String">
        SELECT *	   
        FROM class
        WHERE class_id=#{class_id} 
    </select>
    
    <select id="checkCode" resultType="int" parameterType="hashmap">
    	SELECT count(1)
    	FROM class
    	WHERE class_id=#{class_id} and attend_code=#{code}
    </select>
    
    <update id="updateFlag" parameterType="hashmap">
    	UPDATE enrollment
    	SET attend_yn = 'Y'
    	WHERE user_id=#{user_id} and class_id=#{class_id}
    </update>
    
</mapper>